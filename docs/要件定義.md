# 要件定義

## 基本機能

### 1. ユーザー管理
- **管理者（店長など）とスタッフの区分け**
  - アクセス権限の分離
  - 役割に応じた機能提供
- **ユーザー登録・プロフィール管理**
  - 招待ベースのユーザー登録
  - 基本情報（名前、連絡先等）の管理

### 2. シフト希望提出
- **働ける日時の登録**
  - カレンダーインターフェースによる日時選択
  - 繰り返しパターンの設定
- **希望シフトの提出と編集**
  - 提出期限の設定と通知
  - 編集履歴の記録

### 3. シフト作成・管理
- **管理者によるシフト作成**
  - 希望をベースにしたシフト生成
  - 人員配置の最適化
- **シフトの承認・拒否**
  - 個別承認と一括承認
  - 希望変更時の対応
- **シフト変更・調整**
  - 急な変更に対する対応
  - 同時編集の競合解決

### 4. シフト確認
- **カレンダー表示**
  - 月間/週間/日別表示
  - フィルタリング機能
- **個人/全体シフト閲覧**
  - 権限に応じた表示制限
  - エクスポート機能

### 5. 勤怠管理
- **出勤・退勤記録**
  - ワンクリック打刻
  - 位置情報による検証（オプション）
- **労働時間計算**
  - 自動集計
  - 超過勤務の可視化

## 追加機能（将来実装）

- **通知システム**
  - シフト確定通知
  - 変更通知
  - リマインダー
- **シフト交代申請**
  - 交代希望の掲示板
  - 承認フロー
- **統計・レポート機能**
  - 勤怠状況分析
  - コスト分析
- **給与計算連携**
  - 給与システムとの連携
  - 予測給与表示
- **複数店舗対応**
  - 店舗別管理
  - 本部管理機能
- **PWA対応**
  - オフライン機能
  - プッシュ通知
- **LINEとの連携**
  - LINE通知
  - LINE認証

## セキュリティ要件

### データアクセス制限
- **ロールベースアクセス制御 (RBAC)**
  - 管理者: すべてのデータにアクセス可能
  - スタッフ: 自身のデータと共有されたデータのみアクセス可能
- **API認証**
  - すべてのAPIリクエストはJWTトークンによる認証必須
- **データ分離**
  - テナント分離によるデータ漏洩防止

### バックアップ戦略
- **日次自動バックアップ**
  - PostgreSQLデータの日次バックアップ
  - バックアップデータの暗号化
- **ポイントインタイムリカバリ**
  - ログベースの復元機能
- **リテンションポリシー**
  - 日次バックアップ: 7日間保持
  - 週次バックアップ: 4週間保持
  - 月次バックアップ: 6ヶ月保持

### 通信セキュリティ
- **HTTPS強制**
  - すべての通信をTLS 1.2以上で暗号化
- **HTTP Security Headers**
  - Content-Security-Policy
  - X-XSS-Protection
  - X-Content-Type-Options
  - Strict-Transport-Security

## 拡張性・運用計画

### ユーザー規模
- **初期**: 〜100ユーザー
- **将来**: 複数店舗対応による拡張を視野に入れた設計

### モバイル対応
- **フェーズ1**: レスポンシブWebデザイン
- **フェーズ2**: PWA対応
- **フェーズ3**: LINE連携

## 技術スタック

### フロントエンド
- **Next.js**: Reactベースのフレームワーク
- **ShadCN UI**: UIコンポーネントライブラリ
- **React Hook Form + Zod**: フォーム処理と検証
- **FullCalendar**: カレンダー/シフト表示
- **date-fns**: 日付操作ライブラリ

### バックエンド
- **Next.js API Routes**: APIエンドポイント
- **NextAuth.js (Auth.js)**: 認証システム

### データベース
- **PostgreSQL**: リレーショナルデータベース
- **Prisma**: ORMツール

### デプロイ・インフラ
- **Docker**: コンテナ化
- **CI/CD**: 自動ビルド・デプロイ
- **OCI**: 本番環境ホスティング

## 画面構成

### 認証関連
- **ログイン画面**: メールとパスワードでのログイン
- **登録画面**: 新規ユーザー登録（招待リンク経由も可）
- **パスワードリセット画面**

### 共通画面
- **ダッシュボード**: 
  - 今日/今週のシフト概要
  - お知らせ/通知
  - 次回シフト情報

- **シフトカレンダー**: 
  - 月間/週間/日別表示切替
  - 個人/全体シフト表示
  - シフト詳細確認

- **プロフィール設定**: 
  - 個人情報管理
  - 通知設定
  - パスワード変更

### スタッフ向け画面
- **シフト希望提出**: 
  - カレンダーでの希望日時選択
  - 希望シフト一覧と状態確認
  - 希望修正/キャンセル

- **勤怠記録**: 
  - 出勤/退勤打刻
  - 勤務実績確認
  - 給与見込み表示

- **シフト交代申請**: 
  - 代わりを探す申請
  - 代わる申請の確認

### 管理者向け画面
- **スタッフ管理**: 
  - スタッフ一覧/詳細
  - 招待送信
  - 権限設定

- **シフト作成**: 
  - 自動シフト生成
  - シフト希望一覧
  - シフト確定/編集

- **勤怠管理**: 
  - 全スタッフの勤怠確認
  - 勤務実績集計
  - データエクスポート

- **設定画面**: 
  - 営業時間設定
  - シフトルール設定
  - システム設定 